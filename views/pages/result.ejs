<!DOCTYPE html>
<html>
  <head>
    <title>Resume Feedback</title>
    <link rel="stylesheet" href="/css/result.css">
  </head>

  <body>

    <%- include("../partials/navbar") %>

    <div class="container">
      <h1>✨ AI Resume Feedback ✨</h1>

      <div class="score-badge">
        <span class="score-number" id="scoreNumber"></span>
        <span class="score-text">/ 100</span>
        <p class="score-label">Resume Score</p>
      </div>


      <div id="feedbackContainer"></div>


      <textarea id="feedbackText" hidden></textarea>

      <div style="margin-top: 30px;">
        <button class="btn" onclick="downloadFeedback()">
          Download Feedback
        </button>

        <a class="btn" href="/" style="margin-left: 12px;">
          Analyze another resume
        </a>
      </div>
    </div>

    <script>

      const score = sessionStorage.getItem("score");
      const feedback = sessionStorage.getItem("feedback");

      if (!score || !feedback) {
        alert("No analysis found. Please analyze a resume first.");
        window.location.href = "/";
      }

      document.getElementById("scoreNumber").innerText = score;

      document.getElementById("feedbackText").value = feedback;

      const container = document.getElementById("feedbackContainer");

      feedback.split("\n").forEach(line => {
        const text = line.trim();

        if (text !== "") {
          const p = document.createElement("p");

          p.innerHTML = text
            .replace(/\*\*([^*]+?):\*\*/g, '<span class="label">$1:</span>')
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

          container.appendChild(p);
        }
      });

      function downloadFeedback() {
        const text = document.getElementById("feedbackText").value;

        const blob = new Blob([text], { type: "text/plain" });
        const url = window.URL.createObjectURL(blob);

        const a = document.createElement("a");
        a.href = url;
        a.download = "resume-feedback.txt";
        a.click();

        window.URL.revokeObjectURL(url);
      }
    </script>

  </body>
</html>
