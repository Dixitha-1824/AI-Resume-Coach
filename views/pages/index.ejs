<!DOCTYPE html>
<html>
  <head>
    <title>AI Resume Coach</title>
    <link rel="stylesheet" href="/css/index.css">
  </head>

  <body>
    <%- include("../partials/navbar") %>

    <div class="container">
      <h1>AI Resume Improvement Coach</h1>
      <p class="subtitle">
        Upload your resume and get AI-powered feedback to improve it for your target role.
      </p>

      <form id="resumeForm" enctype="multipart/form-data">
        
        <div class="field">
          <label>Target Role</label>
          <input 
            type="text" 
            name="role" 
            placeholder="e.g. Frontend Developer" 
            required 
          />
        </div>

        <div class="field">
          <label>Experience Level</label>
          <select name="experience" required>
            <option value="">Select</option>
            <option value="student">Student</option>
            <option value="fresher">Fresher</option>
            <option value="experienced">Experienced</option>
          </select>
        </div>

        <div class="field">
          <label>Upload Resume (PDF / TXT)</label>
          <input 
            type="file" 
            name="resume" 
            accept=".pdf,.txt"
            required 
          />
        </div>

        <button type="submit">Analyze Resume</button>
      </form>

      <div id="loader" class="loader hidden">
        <div class="spinner"></div>
        <p>Analyzing your resumeâ€¦</p>
      </div>

    </div>

    <script src="/js/loader.js"></script>

    <script>
      const form = document.getElementById("resumeForm");

      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        const token = localStorage.getItem("token");

        if (!token) {
          alert("Please login first.");
          window.location.href = "/login";
          return;
        }

        document.getElementById("resumeForm").style.display = "none";
        document.getElementById("loader").classList.remove("hidden");

        const formData = new FormData(form);

        try {
          const response = await fetch("/analyze", {
            method: "POST",
            headers: {
              "Authorization": "Bearer " + token
            },
            body: formData
          });

          const data = await response.json();

          if (!response.ok) {
            throw new Error(data.message || "Something went wrong");
          }

          sessionStorage.setItem("score", data.score);
          sessionStorage.setItem("feedback", data.feedback);

          window.location.href = "/result";

        } catch (error) {
          alert(error.message);
          window.location.reload();
        }
      });
    </script>

  </body>
</html>
